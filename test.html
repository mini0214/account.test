<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>測試 GAS 記帳者本期/上期</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  table { border-collapse: collapse; margin-top: 20px; width: 50%; }
  th, td { border: 1px solid #999; padding: 8px 12px; text-align: center; }
  th { background: #eee; }
  pre { background: #f4f4f4; padding: 10px; border-radius: 6px; }
</style>
</head>
<body>

<h2>📊 記帳者本期 / 上期測試</h2>
<button onclick="testQuery記帳者()">🔍 查詢記帳者</button>

<div id="resultBox"></div>

<script>
async function testQuery記帳者() {
  const apiUrl = "https://script.google.com/macros/s/AKfycby-rxd7N7NUMnZp321Kj7o9DCmo2ULp1ZsnzxQcaWzr3Bry9BJpaUtZdJ6b6sZDNLxoKw/exec";

  const payload = {
    type: "query",
    command: "記帳者",
    startDate: "2025-10-01",
    endDate: "2025-10-31"
  };

  try {
    const res = await fetch(apiUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (data.fixedUsers) {
      // 生成表格
      let html = `<table>
        <tr>
          <th>記帳者</th>
          <th>本期總額</th>
          <th>上期總額</th>
        </tr>`;

      Object.entries(data.fixedUsers).forEach(([name, obj]) => {
        html += `<tr>
          <td>${name}</td>
          <td>${obj.current}</td>
          <td>${obj.last}</td>
        </tr>`;
      });

      html += `</table>`;
      document.getElementById("resultBox").innerHTML = html;

    } else {
      document.getElementById("resultBox").innerHTML = "⚠️ 沒有收到 fixedUsers，請檢查 GAS 程式。";
    }

  } catch (err) {
    document.getElementById("resultBox").innerText = "❌ 連線錯誤: " + err.message;
  }
}
</script>

</body>
</html>

