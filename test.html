<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>測試本期/上期總額</title>
</head>
<body>
  <h2>本期/上期總額測試</h2>

  <button id="fetchBtn">取得總額</button>

  <div style="margin-top:20px;">
    <p>記帳者：<span id="userName">Betty Yi</span></p>
    <p>本期總額：<span id="thisMonthTotal">-</span></p>
    <p>上期總額：<span id="lastMonthTotal">-</span></p>
  </div>

  <script>
    document.getElementById("fetchBtn").addEventListener("click", async () => {
      const user = encodeURIComponent("Betty Yi");
      const apiUrl = `https://script.google.com/macros/s/AKfycbw5KeCqOIv_iKEZiZ4rN2l4FyRlAwLYzdN2P4mVZmi9JHfz8xzsG3BsYV1VFThVR0nfAw/exec?type=query&command=總額&user=${user}`;

      try {
        const res = await fetch(apiUrl); // GET 方式
        const data = await res.json();
        console.log("totalData:", data);

        // 直接當字串顯示
        const thisTotal = data?.thisMonth?.total || "0";
        const lastTotal = data?.lastMonth?.total || "0";

        document.getElementById("thisMonthTotal").textContent = thisTotal;
        document.getElementById("lastMonthTotal").textContent = lastTotal;

        alert(`totalData: ${JSON.stringify(data)}`);
      } catch (err) {
        console.error("抓總額失敗：", err);
        alert("抓總額失敗：" + err.message);
      }
    });
  </script>
</body>
</html>
