<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8">
  <title>ä¸‹è¼‰ PDF</title>
</head>
<body style="font-family:sans-serif;text-align:center;padding-top:100px;">
<h2>ðŸ“„ ä¸‹è¼‰å ±è¡¨</h2>
<p>è‹¥æœªè‡ªå‹•ä¸‹è¼‰ï¼Œè«‹é»žä¸‹æ–¹æŒ‰éˆ•ï¼š</p>
<button id="downloadBtn" style="font-size:18px;padding:10px 30px;">ä¸‹è¼‰ PDF</button>

<script>
console.log("âœ… download.html å·²è¼‰å…¥");
const urlParams = new URLSearchParams(window.location.search);
const data = urlParams.get("data");
const name = urlParams.get("name") || "report.pdf";

function downloadPDF(base64Data, filename) {
  const byteChars = atob(base64Data);
  const byteNumbers = new Array(byteChars.length);
  for (let i = 0; i < byteChars.length; i++) byteNumbers[i] = byteChars.charCodeAt(i);
  const blob = new Blob([new Uint8Array(byteNumbers)], { type: "application/pdf" });
  const blobUrl = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = blobUrl;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);

  setTimeout(() => window.close(), 500); // ä¸‹è¼‰å¾Œè‡ªå‹•é—œé–‰
}

if (data) downloadPDF(data, name);

document.getElementById("downloadBtn").addEventListener("click", () => {
  if (data) downloadPDF(data, name);
});
</script>
</body>
</html>
