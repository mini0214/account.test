<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>零用金支出帳簿</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .form-row { margin-bottom: 10px; }
    label { display: inline-block; width: 60px; }
  </style>
</head>
<body>
  <h3>零用金支出帳簿</h3>
  <form id="expenseForm">
    <div class="form-row">
      <label for="date">日期：</label>
      <input type="date" id="date" required>
    </div>

    <div class="form-row">
      <label for="store">店家：</label>
      <input type="text" id="store" list="storeList" placeholder="選填">
      <datalist id="storeList"></datalist>
    </div>

    <div class="form-row">
      <label for="amount">金額：</label>
      <input type="number" id="amount" required>
    </div>

    <button type="submit">送出</button>
  </form>

  <div id="result"></div>

  <script>
    const LIFF_ID = "2008096451-3DobjEw8";   // 換成你的 LIFF ID
    const API_URL = "https://script.google.com/macros/s/AKfycbxYYiOez-4xMhYyXNIdh4MieorwUFd_KXL-dxKUX2hOIihEV2ejGdZkC6WL_Ldhby9ZDQ/exec";

    async function main() {
      await liff.init({ liffId: LIFF_ID });
      if (!liff.isLoggedIn()) liff.login();

      document.getElementById("date").valueAsDate = new Date();

      // 讀取店家清單
      try {
        const res = await fetch(`${API_URL}?type=query&command=店家`);
        const result = await res.json();
        console.log("GAS 回傳：", result);  // 👈 確認有沒有 storeList
        if (result.ok && result.storeList) {
          const datalist = document.getElementById("storeList");
          datalist.innerHTML = "";
          result.storeList.forEach(store => {
            const option = document.createElement("option");
            option.value = store;
            datalist.appendChild(option);
          });
        }
      } catch (err) {
        console.error("載入店家清單失敗:", err);
      }
    }

    document.getElementById("expenseForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = {
        date: document.getElementById("date").value,
        store: document.getElementById("store").value,
        amount: document.getElementById("amount").value
      };
      console.log("送出資料：", data);

      document.getElementById("result").textContent = "✅ 已送出：" + JSON.stringify(data);
      // 這裡可改成 fetch API 上傳到 GAS
    });

    main();
  </script>
</body>
</html>
