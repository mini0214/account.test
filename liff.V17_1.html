let allStores = []; // 儲存 GAS 回傳完整清單

async function loadStoreList() {
  try {
    const res = await fetch(`${API_URL}?type=query&command=店家`);
    const data = await res.json();
    if(data.ok && data.storeList){
      allStores = data.storeList; // 儲存完整列表
      updateDatalist("");       // 初始化 datalist
    }
  } catch(err) {
    console.error("載入店家清單失敗:", err);
  }
}

// 根據輸入即時更新 datalist
const storeInput = document.getElementById("store");
storeInput.addEventListener("input", () => {
  const val = storeInput.value.toLowerCase();
  updateDatalist(val);
});

function updateDatalist(filter) {
  const datalist = document.getElementById("storeList");
  datalist.innerHTML = ""; // 清空選項
  allStores
    .filter(s => s.toLowerCase().includes(filter))  // 過濾
    .forEach(s => {
      const option = document.createElement("option");
      option.value = s;
      datalist.appendChild(option);
    });
}
