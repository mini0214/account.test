<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>é›¶ç”¨é‡‘æ”¯å‡ºå¸³ç°¿</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .form-row { margin-bottom: 10px; }
    label { display: inline-block; width: 60px; }
  </style>
</head>
<body>
  <h3>é›¶ç”¨é‡‘æ”¯å‡ºå¸³ç°¿</h3>
  <form id="expenseForm">
    <div class="form-row">
      <label for="date">æ—¥æœŸï¼š</label>
      <input type="date" id="date" required>
    </div>

    <div class="form-row">
      <label for="store">åº—å®¶ï¼š</label>
      <input type="text" id="store" list="storeList" placeholder="é¸å¡«">
      <datalist id="storeList"></datalist>
    </div>

    <div class="form-row">
      <label for="amount">é‡‘é¡ï¼š</label>
      <input type="number" id="amount" required>
    </div>

    <button type="submit">é€å‡º</button>
  </form>

  <div id="result"></div>

  <script>
    const LIFF_ID = "2008096451-3DobjEw8";   // æ›æˆä½ çš„ LIFF ID
    const API_URL = "https://script.google.com/macros/s/AKfycbxYYiOez-4xMhYyXNIdh4MieorwUFd_KXL-dxKUX2hOIihEV2ejGdZkC6WL_Ldhby9ZDQ/exec";

    async function main() {
      await liff.init({ liffId: LIFF_ID });
      if (!liff.isLoggedIn()) liff.login();

      document.getElementById("date").valueAsDate = new Date();

      // è®€å–åº—å®¶æ¸…å–®
      try {
        const res = await fetch(`${API_URL}?type=query&command=åº—å®¶`);
        const result = await res.json();
        console.log("GAS å›å‚³ï¼š", result);  // ğŸ‘ˆ ç¢ºèªæœ‰æ²’æœ‰ storeList
        if (result.ok && result.storeList) {
          const datalist = document.getElementById("storeList");
          datalist.innerHTML = "";
          result.storeList.forEach(store => {
            const option = document.createElement("option");
            option.value = store;
            datalist.appendChild(option);
          });
        }
      } catch (err) {
        console.error("è¼‰å…¥åº—å®¶æ¸…å–®å¤±æ•—:", err);
      }
    }

    document.getElementById("expenseForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = {
        date: document.getElementById("date").value,
        store: document.getElementById("store").value,
        amount: document.getElementById("amount").value
      };
      console.log("é€å‡ºè³‡æ–™ï¼š", data);

      document.getElementById("result").textContent = "âœ… å·²é€å‡ºï¼š" + JSON.stringify(data);
      // é€™è£¡å¯æ”¹æˆ fetch API ä¸Šå‚³åˆ° GAS
    });

    main();
  </script>
</body>
</html>
