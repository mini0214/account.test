<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>零用金支出帳簿</title>
</head>
<body>

<form id="expenseForm">
  <div>
    <label for="date">日期：</label>
    <input type="date" id="date">
  </div>

  <div>
    <label for="store">店家：</label>
    <input type="text" id="store" list="storeList">
    <datalist id="storeList"></datalist>
  </div>

  <div>
    <label for="amount">金額：</label>
    <input type="number" id="amount" step="0.01">
  </div>

  <button type="submit">送出</button>
</form>

<script>
const API_URL = "你的 GAS URL"; // 改成你的 GAS Path

let allStores = []; // 儲存 GAS 回傳完整清單

async function loadStoreList() {
  try {
    const res = await fetch(`${API_URL}?type=query&command=店家`);
    const data = await res.json();
    if(data.ok && data.storeList){
      allStores = data.storeList; // 儲存完整列表
      updateDatalist(""); // 初始化 datalist
    }
  } catch(err) {
    console.error("載入店家清單失敗:", err);
  }
}

// 根據輸入即時更新 datalist
const storeInput = document.getElementById("store");
storeInput.addEventListener("input", () => {
  const val = storeInput.value.toLowerCase();
  updateDatalist(val);
});

function updateDatalist(filter) {
  const datalist = document.getElementById("storeList");
  datalist.innerHTML = ""; // 清空選項
  allStores
    .filter(s => s.toLowerCase().includes(filter))  // 過濾
    .forEach(s => {
      const option = document.createElement("option");
      option.value = s;
      datalist.appendChild(option);
    });
}

// 頁面載入時先抓店家清單
loadStoreList();

// submit 邏輯
document.getElementById("expenseForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const payload = {
    date: document.getElementById("date").value,
    store: document.getElementById("store").value,
    amount: document.getElementById("amount").value
  };
  try {
    const res = await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify(payload)
    });
    const result = await res.json();
    alert("✅ 已送出：" + JSON.stringify(result));
    document.getElementById("expenseForm").reset();
  } catch(err) {
    alert("❌ 送出失敗：" + err.message);
  }
});
</script>
</body>
</html>
