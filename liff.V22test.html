<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>æŸ¥å–®æ—¥æ”¯å‡º</title>
<style>
  body { font-family: Arial; padding: 20px; }
  input, button { padding: 5px; margin: 5px 0; }
  table { border-collapse: collapse; width: 100%; margin-top: 10px; }
  th, td { border: 1px solid #ccc; padding: 5px; text-align: center; }
  th { background: #f0f0f0; }
</style>
</head>
<body>

<h3>æŸ¥å–®æ—¥æ”¯å‡ºèˆ‡çµ±è¨ˆ</h3>
<label>æ—¥æœŸ (yyyy-mm-dd)ï¼š</label>
<input type="date" id="dateInput">
<button id="queryBtn">æŸ¥è©¢</button>

<div id="result"></div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycby5Y8dZyKDrdnLWefKr-PNPEkxIvrsQKXevupbOrmKmQD1jaDDkHzI_ysrKTEOyjcKaAg/exec"; // âœ…ä½ çš„ GAS URL

document.getElementById("queryBtn").addEventListener("click", async () => {
  const date = document.getElementById("dateInput").value;
  if (!date) return alert("è«‹é¸æ“‡æ—¥æœŸ");

  try {
    const res = await fetch(GAS_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ type: "query", command: "æŸ¥å–®æ—¥", date })
    });
    
    const data = await res.json();
    console.log(data);

    const resultDiv = document.getElementById("result");
    resultDiv.innerHTML = "";

    if (!data.ok) {
      resultDiv.textContent = "æŸ¥è©¢å¤±æ•—ï¼š" + (data.error || "æœªçŸ¥éŒ¯èª¤");
      return;
    }

    if (data.rows.length === 0) {
      resultDiv.textContent = "æŸ¥ç„¡è³‡æ–™";
      return;
    }

    // ğŸ”¹ é¡¯ç¤ºè¡¨æ ¼
    let html = `<h4>æŸ¥è©¢çµæœ (${data.count}ç­†ï¼Œç¸½é‡‘é¡: ${data.total})</h4>`;
    html += "<table><tr>";
    Object.keys(data.rows[0]).forEach((k, i) => {
      html += `<th>${k}</th>`;
    });
    html += "</tr>";

    data.rows.forEach(r => {
      html += "<tr>";
      r.forEach(c => html += `<td>${c}</td>`);
      html += "</tr>";
    });
    html += "</table>";

    // ğŸ”¹ é¡¯ç¤ºåˆ†é¡çµ±è¨ˆ
    html += "<h4>åˆ†é¡çµ±è¨ˆ</h4><ul>";
    for (const [cat, amt] of Object.entries(data.categories)) {
      html += `<li>${cat}: ${amt}</li>`;
    }
    html += "</ul>";

    resultDiv.innerHTML = html;

  } catch (err) {
    console.error(err);
    alert("æŸ¥è©¢ç™¼ç”ŸéŒ¯èª¤ï¼š" + err.message);
  }
});
</script>

</body>
</html>
