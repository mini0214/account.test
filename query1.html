<div id="queryResult"></div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<div id="queryResult"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzp7z2jx-chJ15TGqCNhDuOaJrV92CEGYU-6XrA_qdIjeEg2lFmKwmPZcjfnBthcndbJw/exec"; // 👈 改成你後端的 API
<div id="queryResult"></div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const API_URL = "/your/api/url"; // 👈 改成你後端的 API

async function sendQuery(command) {
  const body = { type: "query", command: command };
  const res = await fetch(API_URL, { method: "POST", body: JSON.stringify(body) });
  const json = await res.json();
  console.log("回傳資料：", json);

  let html = "";

  if (command === "本月店家" && json.stores) {
    html += `<h4>📋 本月店家統計</h4>`;
    html += `<table><tr><th>店家</th><th>金額</th><th>占比</th></tr>`;
    for (const [store, amt] of Object.entries(json.stores)) {
      const percent = ((amt / json.total) * 100).toFixed(1);
      html += `<tr><td>${store}</td><td>${amt}</td><td>${percent}%</td></tr>`;
    }
    html += `</table>`;
    html += `<canvas id="storeChart"></canvas>`;
  }

  document.getElementById("queryResult").innerHTML = html;

  if (command === "本月店家" && json.stores) {
    const ctx = document.getElementById("storeChart").getContext("2d");
    new Chart(ctx, {
      type: "pie",
      data: {
        labels: Object.keys(json.stores),
        datasets: [{ data: Object.values(json.stores) }]
      }
    });
  }
}

// 測試直接呼叫
sendQuery("本月店家");
</script>
